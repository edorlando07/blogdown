---
title: "Loading Multiple Files from Various Folders in R"
author: "Ed Orlando"
date: 2020-05-14
categories: ["R"]
tags: ["R Markdown", "tidyverse", "purrr", "readxl", "Spotify", "Exportify", "R Studio"]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
```

### Author: Ed Orlando

### Problem Statement

R Programmers sometimes have to load multiple files into R. It might also be the case where the files are located in various folders.  This short tutorial walks you through some slick ways on how to programatically read the files in.  As a bonus, the article will also show you how to add the folder and file names to the tibble.

### Load Libraries
The tidyverse and readxl are the only libraries required for this tutorial.

```{r, echo=TRUE, results="hide", warning=FALSE, error=FALSE, message=FALSE}
library(tidyverse)
library(readxl)
```

<br>

### Data Description
In this example, we have Spotify playlist data that was downloaded using [Exportify](<https://rawgit.com/watsonbox/exportify/master/exportify.html>).  Each .xlsx file contains information about the playlist including the artist name, track name, album name, and song duration.  

A sample of one of the the data files is listed below.

```{r, echo=FALSE, results="hide", warning=FALSE, error=FALSE, message=FALSE}
data_sample <- readxl::read_excel(path = "Data_Sources/2020_05_14_Loading_Mult_Files/Genres/Country/90s_country.xlsx")
```
```{r}
data_sample %>% glimpse()
```

<br>

### Folder Structure

Each playlist was previously converted to .xlsx files and placed into the appropriate genre's folder within the project.  The three genre folders are Country, Hip-Hop, and Rock.

```{r}
list.dirs(path = "Data_Sources/2020_05_14_Loading_Mult_Files/Genres/", 
          full.names = FALSE, 
          recursive  = FALSE)
```

<br>

### File Structure

Each playlist folder includes multiple playlist files.  The example below shows the three playlists that exist inside the Country genre folder.

```{r}
list.files(path = "Data_Sources/2020_05_14_Loading_Mult_Files/Genres/Country/", 
          full.names = FALSE, 
          recursive  = FALSE)
```

<br>

### View Files in Each Folder

A function was created that lists the .xlsx files in each genre folder. The function utilizes the **base::list.files()** function that lists each file under a particular folder.

```{r, echo=TRUE}
list_files_in_folder <- function(genre) {
    
    list.files(path = str_c("Data_Sources/2020_05_14_Loading_Mult_Files/Genres/", genre),
                          pattern = "*.xlsx", 
                          full.names = TRUE) %>% 
    tibble::enframe()
}
```

<br>

For example, if we want to view all the files in the Country genre folder, we can now easily pass "Country" into the function.

```{r}
list_files_in_folder("Country")
```

<br>

Next, a genre list was created that includes all three genres.  This step will allow us to map the **list_files_in_folder()** function to multiple genre folders later on.
```{r}
genre_list <- c("Country", "Hip_Hop", "Rock")
```

<br>

The **genre_list** was mapped into the function listed below.  The final result is a tibble with all .xlsx files from the folders we specified above.

```{r}
playlist_tbl <- genre_list %>% 
  map_df(list_files_in_folder)
```

```{r}
playlist_tbl %>% glimpse()
```

<br>

The value column was extracted from the **playlist_tbl** above and transformed into a list.

```{r}
playlist_list <- playlist_tbl %>%
  select(value) %>%
  as.list()

playlist_list$value
```

<br>

The **playlist_list$value** was then mapped into the function below which read each .xlsx file and added the file name and path into a tibble.

```{r results="hide", warning=FALSE, error=FALSE, message=FALSE}
song_tbl <- playlist_list$value %>% 
    map_df(function(add_file_name)
        read_excel(add_file_name) %>%
            mutate(playlist_name = gsub(".xlsx", 
                                        "", 
                                        basename(add_file_name))) %>%
            mutate(filename = add_file_name)
    )
```

```{r}
song_tbl %>% 
  glimpse()
```

<br>

Since the entire path and file name are all listed in the same column, the **separate()** function was used to split out Folders 1:3, Genre, and the Playlist into separate columns.

```{r}
song_tidy_tbl <- song_tbl %>% 
            separate(col    = filename, 
                     into   = c("Folder_01", 
                                "Folder_02", 
                                "Folder_03", 
                                "Genre", 
                                "Playlist"),
                     sep    = "/",
                     remove = FALSE)
```

<br>

The final tibble is complete.

```{r}
song_tidy_tbl %>% glimpse()
```

